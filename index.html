<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Notion Expense Tracker</title>
<style>
:root {
  /* Strawberry Matcha palette */
  --bg:#fff7f9;
  --card:#ffffff;
  --primary:#f28cab;   /* strawberry */
  --secondary:#7fbf9b; /* matcha */
  --warning:#ffb703;
  --danger:#ef476f;
  --text:#2f2f2f;
  --muted:#888;
}
body{
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:var(--bg);
  padding:16px;
  max-width:560px;
  margin:auto;
  color:var(--text);
}
h2{margin-bottom:6px}
.card{
  background:var(--card);
  border-radius:14px;
  padding:14px;
  box-shadow:0 6px 18px rgba(0,0,0,.06);
  margin-bottom:14px;
}
label{font-size:13px;color:var(--muted)}
input,select{
  width:100%;padding:7px;margin:4px 0 10px;
  border-radius:8px;border:1px solid #ddd;
}
button{
  padding:8px 10px;border:none;border-radius:10px;
  background:var(--primary);color:white;font-weight:600;cursor:pointer
}
button.small{font-size:12px;padding:4px 6px}
.tabs{display:flex;gap:6px;overflow-x:auto;margin-bottom:10px}
.tab{padding:6px 10px;border-radius:999px;background:#eee;font-size:13px;cursor:pointer}
.tab.active{background:var(--secondary);color:white}
.progress{background:#eee;border-radius:999px;overflow:hidden;height:14px;margin:10px 0}
.progress-bar{height:100%;width:0%;transition:.3s}
.progress-bar.safe{background:linear-gradient(90deg,var(--secondary),var(--primary))}
.progress-bar.warn{background:var(--warning)}
.progress-bar.danger{background:var(--danger)}
table{width:100%;font-size:13px;border-collapse:collapse}
th,td{border-bottom:1px solid #eee;padding:6px;text-align:left}
.pill{font-size:11px;padding:2px 6px;border-radius:999px;color:white}
.fixed{background:var(--secondary)}
.variable{background:var(--primary)}
.row{display:flex;gap:8px}
.row>*{flex:1}
.summary{display:flex;justify-content:space-between;font-size:13px;margin-top:6px}
.export{background:#222;width:100%;margin-top:6px}
</style>
</head>
<body>
<h2>Expense Tracker</h2>
<div class="tabs" id="monthTabs"></div>

<div class="card">
  <label>Monthly Income</label>
  <input id="income" type="number" />

  <label>Budget cap (warning at 80%, red at 100%)</label>
  <input id="budget" type="number" placeholder="Optional" />

  <div class="row">
    <input id="expenseName" placeholder="Expense name" />
    <input id="expenseAmount" type="number" placeholder="Amount" />
  </div>
  <div class="row">
    <select id="expenseType">
      <option value="fixed">Fixed</option>
      <option value="variable">Variable</option>
    </select>
    <button onclick="addExpense()">Add</button>
  </div>

  <div class="progress"><div id="progressBar" class="progress-bar safe"></div></div>
  <p><strong>Remaining:</strong> <span id="remaining">0</span></p>
</div>

<div class="card">
  <table>
    <thead><tr><th>Expense</th><th>Type</th><th>Amount</th><th></th></tr></thead>
    <tbody id="expenseTable"></tbody>
  </table>
</div>

<div class="card">
  <strong>Monthly summary</strong>
  <div class="summary"><span>Fixed</span><span id="sumFixed">0</span></div>
  <div class="summary"><span>Variable</span><span id="sumVariable">0</span></div>
  <div class="summary"><span>Total spent</span><span id="sumTotal">0</span></div>
</div>

<div class="card">
  <button class="export" onclick="exportCSV()">Export Month → CSV (Notion / Sheets)</button>
</div>

<script>
const store = JSON.parse(localStorage.getItem('expense-tracker')) || {};
const tabs = document.getElementById('monthTabs');
let currentMonth = new Date().toISOString().slice(0,7);
if(!store[currentMonth]) store[currentMonth]={income:0,budget:0,expenses:[]};

function save(){localStorage.setItem('expense-tracker',JSON.stringify(store))}

function renderTabs(){
  tabs.innerHTML='';
  Object.keys(store).sort().forEach(m=>{
    const t=document.createElement('div');
    t.className='tab'+(m===currentMonth?' active':'');
    t.textContent=m;
    t.onclick=()=>{currentMonth=m;render()};
    tabs.appendChild(t);
  })
}

function render(){
  const d=store[currentMonth];
  income.value=d.income||'';
  budget.value=d.budget||'';
  expenseTable.innerHTML='';
  let spent=0,fixed=0,variable=0;

  d.expenses.forEach((e,i)=>{
    spent+=e.amount;
    e.type==='fixed'?fixed+=e.amount:variable+=e.amount;
    expenseTable.innerHTML+=`<tr>
      <td><input value="${e.name}" onchange="edit(${i},'name',this.value)"></td>
      <td><span class="pill ${e.type}">${e.type}</span></td>
      <td><input type="number" value="${e.amount}" onchange="edit(${i},'amount',this.value)"></td>
      <td><button class="small" onclick="del(${i})">✕</button></td>
    </tr>`;
  });

  sumFixed.textContent=fixed.toFixed(2);
  sumVariable.textContent=variable.toFixed(2);
  sumTotal.textContent=spent.toFixed(2);

  const remaining=d.income-spent;
  remainingEl.textContent=remaining.toFixed(2);

  const cap=d.budget||d.income;
  const pct=cap?spent/cap:0;
  progressBar.style.width=Math.min(100,pct*100)+'%';
  progressBar.className='progress-bar '+(pct>=1?'danger':pct>=.8?'warn':'safe');

  save();renderTabs();
}

income.oninput=()=>{store[currentMonth].income=+income.value;render()}
budget.oninput=()=>{store[currentMonth].budget=+budget.value;render()}

function addExpense(){
  if(!expenseName.value||!expenseAmount.value)return;
  store[currentMonth].expenses.push({
    name:expenseName.value,
    amount:+expenseAmount.value,
    type:expenseType.value
  });
  expenseName.value='';expenseAmount.value='';render();
}

function edit(i,k,v){store[currentMonth].expenses[i][k]=k==='amount'?+v:v;render()}
function del(i){store[currentMonth].expenses.splice(i,1);render()}

function exportCSV(){
  const d=store[currentMonth];
  let csv='Month,Income,Budget,Expense,Type,Amount\n';
  d.expenses.forEach(e=>csv+=`${currentMonth},${d.income},${d.budget},${e.name},${e.type},${e.amount}\n`);
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));
  a.download=`expenses-${currentMonth}.csv`;a.click();
}

render();
</script>
</body>
</html>
