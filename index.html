<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Notion Expense Tracker</title>
<style>
:root{
  --bg:#fff7f9;--card:#ffffff;--strawberry:#f28cab;--matcha:#7fbf9b;
  --warning:#ffb703;--danger:#ef476f;--text:#2f2f2f;--muted:#777;
}
*{box-sizing:border-box}
body{font-family:system-ui,-apple-system,sans-serif;background:var(--bg);padding:16px;max-width:1200px;margin:auto;color:var(--text)}
h2{margin-bottom:12px}
.card{background:var(--card);border-radius:18px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
.layout{display:grid;grid-template-columns:70% 30%;gap:16px}
label{font-size:13px;color:var(--muted);display:block;margin-bottom:4px}
input,select{width:100%;padding:8px;border-radius:10px;border:1px solid #ddd;margin-bottom:10px}
button{padding:8px 12px;border:none;border-radius:10px;background:var(--strawberry);color:white;font-weight:600;cursor:pointer}
button.matcha{background:var(--matcha)}
button.small{font-size:12px;padding:4px 8px}
.tabs{display:flex;gap:6px;margin-bottom:12px}
.tab{padding:6px 12px;border-radius:999px;background:#eee;font-size:13px;cursor:pointer}
.tab.active{background:var(--matcha);color:white}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.progress{background:#eee;border-radius:999px;overflow:hidden;height:14px;margin:6px 0}
.progress-bar{height:100%;width:0%;transition:.3s}
.safe{background:linear-gradient(90deg,var(--matcha),var(--strawberry))}
.warn{background:var(--warning)}
.danger{background:var(--danger)}
.remaining{background:var(--strawberry);color:white;padding:10px;border-radius:14px;font-weight:700;text-align:center;margin-top:10px}
.summary-row{display:flex;justify-content:space-between;font-size:14px;margin:6px 0}
table{width:100%;font-size:13px;border-collapse:collapse;margin-top:10px}
th,td{border-bottom:1px solid #eee;padding:8px;text-align:left}
.hidden{display:none}
</style>
</head>
<body>
<h2>Expense Tracker</h2>
<div class="tabs">
  <div class="tab active" onclick="switchView('track')">Track</div>
  <div class="tab" onclick="switchView('edit')">Edit</div>
  <div class="tab" onclick="switchView('charts')">Charts</div>
</div>

<div class="layout">

  <!-- MAIN BOX (70%) -->
  <div class="card">

    <!-- TRACK -->
    <div id="trackView">
      <div class="grid-2"><div><label>Monthly income</label><input id="income" type="number" /></div><div><label>Savings goal</label><input id="savingsGoal" type="number" /></div></div>

      <label>Expense</label>
      <div class="grid-2">
        <input id="expenseName" placeholder="Name" />
        <input id="expenseAmount" type="number" placeholder="Amount" />
      </div>

      <div class="grid-2">
        <div>
          <label>Type</label>
          <select id="expenseType">
            <option value="fixed">Fixed</option>
            <option value="variable">Variable</option>
          </select>
        </div>
        <div>
          <label>Category</label>
          <select id="expenseCategory">
            <option>Rent</option><option>Food</option><option>Fun</option><option>Travel</option><option>Bills</option><option>Saved</option>
          </select>
        </div>
      </div>

      <button onclick="addExpense()">Add expense</button>
    </div>

    <!-- EDIT -->
    <div id="editView" class="hidden">
      <table>
        <thead><tr><th>Name</th><th>Type</th><th>Category</th><th>Amount</th><th></th></tr></thead>
        <tbody id="expenseTable"></tbody>
      </table>
    </div>

    <!-- CHARTS -->
    <div id="chartsView" class="hidden">
  <div class="grid-2">
    <div class="card"><strong>Income</strong><div id="kpiIncome">0</div></div>
    <div class="card"><strong>Expenses</strong><div id="kpiExpenses">0</div></div>
    <div class="card"><strong>Saved</strong><div id="kpiSaved">0</div></div>
  </div>
  <canvas id="pie" height="200" style="margin-top:20px"></canvas>
  <canvas id="trend" height="220" style="margin-top:20px"></canvas>
</div>

  </div>

  <!-- SUMMARY BOX (30%) -->
  <div class="card">
    <h3>Monthly summary</h3>
    <div class="summary-row"><span>Income</span><span id="sumIncome">0</span></div>
    <div class="summary-row"><span>Expenses</span><span id="sumExpenses">0</span></div>
    <div class="summary-row"><span>Saved</span><span id="sumSaved">0</span></div>

    <small>Income usage</small>
    <div class="progress"><div id="incomeBar" class="progress-bar safe"></div></div>

    <small>Savings goal</small>
    <div class="progress"><div id="savingsBar" class="progress-bar safe"></div></div>

    <div class="remaining">Remaining this month: <span id="remaining">0</span></div>
    <button class="matcha small" style="width:100%;margin-top:6px" onclick="manualSync()">Manual sync → CSV</button>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const store = JSON.parse(localStorage.getItem('tracker')) || { savingsGoal: 0, months: {} };
let month = new Date().toISOString().slice(0,7);

function data(){ if(!store.months[month]) store.months[month]={income:0,expenses:[]}; return store.months[month]; }
function save(){ localStorage.setItem('tracker', JSON.stringify(store)); }

function switchView(v){ ['track','edit','charts'].forEach(x=>{
  document.getElementById(x+'View').classList.toggle('hidden',x!==v);
}); document.querySelectorAll('.tab').forEach((t,i)=>t.classList.toggle('active',[ 'track','edit','charts'][i]===v)); render(); }

function addExpense(){
  if(!expenseName.value||!expenseAmount.value) return;
  data().expenses.push({name:expenseName.value,amount:+expenseAmount.value,type:expenseType.value,category:expenseCategory.value});
  expenseName.value=''; expenseAmount.value=''; save(); render();
}

income.oninput=()=>{ data().income=+income.value; save(); render(); }

function render(){
  const d=data(); income.value=d.income||'';
  let spent=0,saved=0; expenseTable.innerHTML='';

  d.expenses.forEach((e,i)=>{
    if(e.category==='Saved') saved+=e.amount; else spent+=e.amount;
    expenseTable.innerHTML+=`<tr><td>${e.name}</td><td>${e.type}</td><td>${e.category}</td><td>${e.amount}</td><td><button class='small' onclick='del(${i})'>✕</button></td></tr>`;
  });

  sumIncome.textContent=d.income.toFixed(2);
  sumExpenses.textContent=spent.toFixed(2);
  sumSaved.textContent=saved.toFixed(2);
  remaining.textContent=(d.income-spent).toFixed(2);

  incomeBar.style.width=Math.min(100,(spent/d.income)*100||0)+'%';
  savingsBar.style.width=Math.min(100,(saved/(store.savingsGoal||1))*100)+'%';

  drawCharts(d);
}

function del(i){ data().expenses.splice(i,1); save(); render(); }

function drawCharts(d){
  const cats={}; d.expenses.forEach(e=>{ if(e.category!=='Saved') cats[e.category]=(cats[e.category]||0)+e.amount; });
  if(window.pieChart) pieChart.destroy();
  pieChart=new Chart(pie,{type:'pie',data:{labels:Object.keys(cats),datasets:[{data:Object.values(cats),backgroundColor:['#f28cab','#7fbf9b','#ffd6e0','#b7e4c7','#ffb703']}]}});
}

function manualSync(){
  let csv='Month,Income,Name,Type,Category,Amount\n';
  data().expenses.forEach(e=>csv+=`${month},${data().income},${e.name},${e.type},${e.category},${e.amount}\n`);
  const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'})); a.download=`${month}.csv`; a.click();
}

render();
</script>
</body>
</html>
