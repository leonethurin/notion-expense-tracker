<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Expense Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
  /* STRAWBERRY MATCHA PALETTE */
  --matcha: #8fc7a4;
  --matcha-dark: #669e7c; /* Green for text/title */
  --matcha-light: #e8f5e9;
  
  --strawberry: #f48fb1;
  --strawberry-hover: #ec7aa0;
  --strawberry-dark: #d81b60;
  --strawberry-light: #fce4ec;
  
  --text-main: #37352f;
  --text-light: #787774;
  --bg-color: #f7f6f3; 
  --card-bg: #ffffff;
  --input-bg: #f3f4f6; 
  --border-color: #ebebeb;
}

* { box-sizing: border-box; }

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg-color);
  color: var(--text-main);
  margin: 0;
  height: 100vh; 
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden; 
}

.app {
  width: 100%;
  max-width: 1100px;
  padding: 0 20px;
}

/* --- BRAND HEADER --- */
.top-brand {
    margin-bottom: 12px;
    font-weight: 700; 
    color: var(--matcha-dark); /* Green Title */
    font-size: 22px;
    display: flex;
    align-items: center;
    gap: 8px;
    letter-spacing: -0.5px;
}

/* --- LAYOUT GRID --- */
.container {
  display: grid;
  grid-template-columns: 1fr 320px;
  gap: 20px;
}

/* FIXED HEIGHT CARDS */
/* Reduced height to 510px (approx 2 rows shorter) */
.main-card, .sidebar-card {
  background: var(--card-bg);
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.03);
  border: 1px solid rgba(0,0,0,0.04);
  height: 510px; 
  display: flex;
  flex-direction: column;
  position: relative;
  overflow: hidden; 
}

/* --- CARD HEADER (Tabs + Month Select) --- */
.card-header-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  flex-shrink: 0;
}

/* TABS */
.tabs {
  display: flex;
  gap: 4px;
  background: #f4f4f5;
  padding: 4px;
  border-radius: 10px;
}

.tabs button {
  padding: 6px 14px;
  border-radius: 8px;
  border: none;
  background: transparent;
  color: var(--text-light);
  font-weight: 500;
  font-size: 13px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.tabs button.active {
  background: white;
  color: var(--strawberry-dark);
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  font-weight: 600;
}

/* MONTH SELECTOR */
#monthSelect {
    width: auto;
    border: none;
    background: #f4f4f5;
    padding: 6px 12px;
    border-radius: 8px;
    font-weight: 600;
    color: var(--text-main);
    cursor: pointer;
    font-size: 13px;
}
#monthSelect:hover { background: #eaeaeb; }
#monthSelect:focus { box-shadow: none; border: none; outline: 2px solid var(--strawberry); }


/* --- CONTENT AREAS --- */
.tab-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    padding: 2px;
}

.hidden { display: none !important; }

/* INPUTS (Generic) */
label {
  display: block;
  font-size: 11px;
  font-weight: 700;
  color: var(--text-light);
  margin-bottom: 5px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

input, select {
  width: 100%;
  padding: 9px 12px; /* Slightly smaller vertical padding for compactness */
  border-radius: 8px;
  border: 1px solid transparent; 
  font-size: 13px;
  background: var(--input-bg); /* Default Light Grey */
  transition: all 0.2s;
  color: var(--text-main);
}

input:focus, select:focus {
  outline: none;
  background: #fff;
  border-color: var(--strawberry);
  box-shadow: 0 0 0 3px var(--strawberry-light);
}

/* ADD EXPENSE BOX (Special Styling) */
.add-expense-box {
    background: #FAFAFA; /* Specific background per request */
    padding: 18px;
    border-radius: 12px;
    margin-top: 16px;
    border: 1px solid #eeeeee;
}

/* Inputs inside Add Expense Box are White */
.add-expense-box input, 
.add-expense-box select {
    background: #FFFFFF;
    border: 1px solid #e0e0e0; /* Subtle border to make them pop */
}
.add-expense-box input:focus, 
.add-expense-box select:focus {
    border-color: var(--strawberry);
}

/* BUTTONS */
.btn-primary {
  background: var(--strawberry);
  color: white;
  border: none;
  border-radius: 8px;
  padding: 10px;
  font-weight: 600;
  cursor: pointer;
  width: 100%;
  margin-top: 14px;
  font-size: 14px;
  transition: transform 0.1s, background 0.2s;
  box-shadow: 0 4px 10px rgba(244, 143, 177, 0.3);
}
.btn-primary:hover { 
    background: var(--strawberry-hover); 
    transform: translateY(-1px);
}

.btn-delete {
    background: transparent;
    color: #ff6b6b;
    border: none;
    font-size: 14px;
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
}
.btn-delete:hover { background: #ffebee; }

/* --- TABLE (EXPENSES) --- */
.table-container {
    height: 100%; 
    border: 1px solid var(--border-color);
    border-radius: 12px;
    overflow: hidden; 
    display: flex;
    flex-direction: column;
}

.expenses-scroll {
    overflow-y: auto; 
    flex: 1; 
}

/* Scrollbar */
.expenses-scroll::-webkit-scrollbar { width: 6px; }
.expenses-scroll::-webkit-scrollbar-track { background: transparent; }
.expenses-scroll::-webkit-scrollbar-thumb { background: #e0e0e0; border-radius: 4px; }

table { width: 100%; border-collapse: collapse; }

th {
  background: #fff;
  text-align: left;
  padding: 12px;
  font-size: 11px;
  color: var(--text-light);
  font-weight: 600;
  position: sticky;
  top: 0;
  border-bottom: 1px solid var(--border-color);
  z-index: 10;
}

td {
  padding: 8px 12px;
  border-bottom: 1px solid var(--border-color);
  font-size: 13px;
  vertical-align: middle;
}

/* Table Inputs */
td input, td select {
    padding: 5px;
    font-size: 13px;
    margin: -5px; 
    width: calc(100% + 10px);
    background: transparent;
    border: 1px solid transparent;
}
td input:hover, td select:hover { background: #f5f5f5; }
td input:focus, td select:focus { 
    background: white; 
    border-color: var(--strawberry); 
    box-shadow: none;
}

/* --- CHARTS & KPIS --- */
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 16px;
    flex-shrink: 0;
}

.kpi-card {
    border-radius: 12px;
    padding: 14px;
    text-align: center;
    color: white;
}
.kpi-card h4 { margin: 0 0 4px 0; font-weight: 500; font-size: 12px; opacity: 0.95; }
.kpi-card strong { font-size: 18px; font-weight: 700; }

.bg-pink { background: var(--strawberry); }
.bg-green { background: var(--matcha); }

.charts-area {
    background: #fafafa;
    border-radius: 16px;
    padding: 16px;
    border: 1px solid rgba(0,0,0,0.03);
    flex: 1; 
    display: flex;
    gap: 16px;
    align-items: center;
    overflow: hidden; 
    min-height: 0; 
}

.chart-wrapper-pie { width: 35%; height: 100%; position: relative; }
.chart-wrapper-line { width: 65%; height: 100%; position: relative; }


/* --- SIDEBAR SUMMARY --- */
.sidebar-section { margin-bottom: 24px; }

.summary-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    padding: 8px 12px; /* Slightly tighter */
    border-radius: 10px;
    font-size: 13px;
}

.sum-green { background: var(--matcha-light); color: var(--matcha-dark); }
.sum-pink { background: var(--strawberry-light); color: var(--strawberry-dark); }

.summary-item span:first-child { font-weight: 500; }
.summary-item span:last-child { font-weight: 700; font-size: 14px; }

.progress-group { margin-bottom: 16px; }
.progress-header {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    margin-bottom: 6px;
    color: var(--text-light);
    font-weight: 600;
}
.progress-track {
    height: 8px;
    background: #f0f0f0;
    border-radius: 20px;
    overflow: hidden;
}
.progress-fill { height: 100%; transition: width 0.6s cubic-bezier(0.22, 1, 0.36, 1); }

.remaining-card {
    background: var(--strawberry);
    color: white;
    padding: 18px;
    border-radius: 14px;
    text-align: center;
    margin-top: auto; 
    box-shadow: 0 4px 12px rgba(244, 143, 177, 0.4);
}
.remaining-card p { margin: 0 0 6px 0; font-size: 12px; opacity: 0.9; }
.remaining-card strong { font-size: 26px; display: block; }

.btn-export {
    margin-top: 10px;
    width: 100%;
    background: transparent;
    border: 1px dashed #ccc;
    color: var(--text-light);
    padding: 8px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 11px;
    transition: all 0.2s;
}
.btn-export:hover { border-color: var(--strawberry); color: var(--strawberry); background: var(--strawberry-light); }

.grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.grid-4 { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 10px; }

</style>
</head>

<body>
<div class="app">

  <div class="top-brand">
      Expense tracker ðŸ’¸
  </div>

  <div class="container">
    
    <div class="main-card">
            
        <div class="card-header-row">
            <div class="tabs">
                <button class="active" onclick="showTab('track')">Track</button>
                <button onclick="showTab('expenses')">Expenses</button>
                <button onclick="showTab('charts')">Charts</button>
            </div>
            
            <select id="monthSelect" onchange="changeMonth()"></select>
        </div>

        <div id="track" class="tab-content">
            <div class="grid-2">
                <div>
                    <label>Monthly Income</label>
                    <input id="income" type="number" onchange="saveMeta()" placeholder="e.g. 25000" />
                </div>
                <div>
                    <label>Savings Goal</label>
                    <input id="savingsGoal" type="number" onchange="saveMeta()" placeholder="e.g. 5000" />
                </div>
            </div>

            <div class="add-expense-box">
                <h3 style="margin-top:0; color: var(--text-main); margin-bottom: 12px; font-size: 14px;">Add New Expense</h3>
                <div class="grid-4">
                    <div>
                        <label>Name</label>
                        <input id="inputName" placeholder="Item name" />
                    </div>
                    <div>
                        <label>Amount</label>
                        <input id="inputAmount" type="number" placeholder="0" />
                    </div>
                    <div>
                        <label>Type</label>
                        <select id="inputType">
                            <option>Fixed</option>
                            <option>Variable</option>
                        </select>
                    </div>
                    <div>
                        <label>Category</label>
                        <select id="inputCategory">
                            <option>Rent</option>
                            <option>Food</option>
                            <option>Fun</option>
                            <option>Travel</option>
                            <option>Bills</option>
                            <option>Saved</option>
                            <option>Other</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn-primary" onclick="addExpense()">+ Add Expense</button>
            </div>
        </div>

        <div id="expenses" class="tab-content hidden">
            <div class="table-container">
                <div class="expenses-scroll">
                    <table>
                        <thead>
                            <tr>
                                <th style="width:120px;">Date</th>
                                <th>Name</th>
                                <th style="width:90px;">Amount</th>
                                <th style="width:80px;">Type</th>
                                <th style="width:100px;">Category</th>
                                <th style="width:30px;"></th>
                            </tr>
                        </thead>
                        <tbody id="expenseTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="charts" class="tab-content hidden">
            <div class="dashboard-grid">
                <div class="kpi-card bg-pink">
                    <h4>Income</h4>
                    <strong id="kIncome">0</strong>
                </div>
                <div class="kpi-card bg-green">
                    <h4>Expenses</h4>
                    <strong id="kExpenses">0</strong>
                </div>
                <div class="kpi-card bg-pink">
                    <h4>Saved</h4>
                    <strong id="kSaved">0</strong>
                </div>
            </div>

            <div class="charts-area">
                <div class="chart-wrapper-pie">
                    <canvas id="pieChart"></canvas>
                </div>
                <div class="chart-wrapper-line">
                    <canvas id="lineChart"></canvas>
                </div>
            </div>
        </div>

    </div>

    <div class="sidebar-card">
        <h3 style="margin-top:0; margin-bottom:16px; font-size:16px;">Monthly Summary</h3>
        
        <div class="sidebar-section">
            <div class="summary-item sum-green">
                <span>Income</span>
                <span id="sIncome">0</span>
            </div>
            <div class="summary-item sum-pink">
                <span>Expenses</span>
                <span id="sExpenses">0</span>
            </div>
            <div class="summary-item sum-green">
                <span>Saved</span>
                <span id="sSaved">0</span>
            </div>
        </div>

        <div class="progress-group">
            <div class="progress-header">
                <span>Income Usage</span>
                <span id="incomeUsageText">0%</span>
            </div>
            <div class="progress-track">
                <div id="incomeBar" class="progress-fill" style="background:var(--matcha); width:0%"></div>
            </div>
        </div>

        <div class="progress-group">
            <div class="progress-header">
                <span>Savings Goal</span>
                <span id="goalText">0%</span>
            </div>
            <div class="progress-track">
                <div id="saveBar" class="progress-fill" style="background:var(--strawberry); width:0%"></div>
            </div>
        </div>

        <div class="remaining-card">
            <p>Remaining this month</p>
            <strong id="remaining">0</strong>
        </div>

        <button class="btn-export" onclick="exportCSV()">Export CSV</button>
    </div>

  </div>
</div>

<script>
// ---------- LOGIC ----------
let data = JSON.parse(localStorage.getItem("budgetData")) || {};
let currentMonth = new Date().toISOString().slice(0,7);

function formatMoney(num) {
    if(!num) return "0";
    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
}

function initMonths(){
  const sel = document.getElementById('monthSelect');
  sel.innerHTML = "";
  for(let i=0; i<6; i++){
    const d = new Date();
    d.setMonth(d.getMonth() - i);
    const m = d.toISOString().slice(0,7);
    const opt = document.createElement('option');
    opt.value = m;
    opt.innerText = m;
    sel.appendChild(opt);
  }
  sel.value = currentMonth;
}

function getMonth(){
  if(!data[currentMonth]) data[currentMonth] = { income: 0, goal: 0, expenses: [] };
  return data[currentMonth];
}

function save(){ localStorage.setItem("budgetData", JSON.stringify(data)); }

function changeMonth(){ 
    currentMonth = document.getElementById('monthSelect').value; 
    render(); 
}

function saveMeta(){
  const m = getMonth();
  m.income = +document.getElementById('income').value;
  m.goal = +document.getElementById('savingsGoal').value;
  save(); 
  render();
}

function addExpense(){
  const nameVal = document.getElementById('inputName').value;
  const amountVal = document.getElementById('inputAmount').value;
  const typeVal = document.getElementById('inputType').value;
  const catVal = document.getElementById('inputCategory').value;

  if(!nameVal || !amountVal) {
      alert("Please enter name and amount");
      return;
  }

  getMonth().expenses.push({
    id: Date.now(),
    name: nameVal,
    amount: +amountVal,
    type: typeVal,
    category: catVal,
    date: new Date().toISOString().slice(0,10)
  });

  document.getElementById('inputName').value = "";
  document.getElementById('inputAmount').value = "";
  
  save(); 
  render();
}

window.updateExpense = function(index, field, element) {
    const m = getMonth();
    let val = element.value;
    if(field === 'amount') val = Number(val);
    m.expenses[index][field] = val;
    save();
    render();
}

function deleteExpense(i){
  if(confirm("Delete this expense?")){
      getMonth().expenses.splice(i,1);
      save(); 
      render();
  }
}

let pieChartInstance, lineChartInstance;

function render(){
  const m = getMonth();
  
  if(document.activeElement.id !== 'income') document.getElementById('income').value = m.income || "";
  if(document.activeElement.id !== 'savingsGoal') document.getElementById('savingsGoal').value = m.goal || "";

  let totalExp = m.expenses.filter(e => e.category !== "Saved").reduce((a,b) => a + b.amount, 0);
  let totalSaved = m.expenses.filter(e => e.category === "Saved").reduce((a,b) => a + b.amount, 0);
  let remainingVal = m.income - totalExp - totalSaved;

  document.getElementById('kIncome').textContent = formatMoney(m.income);
  document.getElementById('sIncome').textContent = formatMoney(m.income);
  
  document.getElementById('kExpenses').textContent = formatMoney(totalExp);
  document.getElementById('sExpenses').textContent = formatMoney(totalExp);

  document.getElementById('kSaved').textContent = formatMoney(totalSaved);
  document.getElementById('sSaved').textContent = formatMoney(totalSaved);

  document.getElementById('remaining').textContent = formatMoney(remainingVal.toFixed(2));

  const incomePct = m.income ? Math.min((totalExp / m.income) * 100, 100) : 0;
  document.getElementById('incomeBar').style.width = incomePct + "%";
  document.getElementById('incomeUsageText').textContent = incomePct.toFixed(0) + "% used";

  const goalPct = m.goal ? Math.min((totalSaved / m.goal) * 100, 100) : 0;
  document.getElementById('saveBar').style.width = goalPct + "%";
  document.getElementById('goalText').textContent = goalPct.toFixed(0) + "% reached";

  const tbody = document.getElementById('expenseTable');
  tbody.innerHTML = m.expenses.map((e, i) => `
    <tr>
      <td><input type="date" value="${e.date}" onchange="updateExpense(${i}, 'date', this)"></td>
      <td><input type="text" value="${e.name}" onchange="updateExpense(${i}, 'name', this)"></td>
      <td><input type="number" value="${e.amount}" onchange="updateExpense(${i}, 'amount', this)"></td>
      <td>
        <select onchange="updateExpense(${i}, 'type', this)">
            <option ${e.type=="Fixed"?"selected":""}>Fixed</option>
            <option ${e.type=="Variable"?"selected":""}>Variable</option>
        </select>
      </td>
      <td>
        <select onchange="updateExpense(${i}, 'category', this)">
            <option ${e.category=="Rent"?"selected":""}>Rent</option>
            <option ${e.category=="Food"?"selected":""}>Food</option>
            <option ${e.category=="Fun"?"selected":""}>Fun</option>
            <option ${e.category=="Travel"?"selected":""}>Travel</option>
            <option ${e.category=="Bills"?"selected":""}>Bills</option>
            <option ${e.category=="Saved"?"selected":""}>Saved</option>
            <option ${e.category=="Other"?"selected":""}>Other</option>
        </select>
      </td>
      <td><button class="btn-delete" onclick="deleteExpense(${i})">âœ•</button></td>
    </tr>
  `).join("");

  drawCharts(m);
}

function drawCharts(m){
  const cats = {};
  m.expenses.filter(e => e.category !== "Saved").forEach(e => {
      cats[e.category] = (cats[e.category] || 0) + e.amount;
  });

  const pieCtx = document.getElementById('pieChart').getContext('2d');
  if(pieChartInstance) pieChartInstance.destroy();
  
  const colors = ["#f48fb1", "#8fc7a4", "#a5d6a7", "#f06292", "#c8e6c9", "#f8bbd0", "#ffecb3"];

  pieChartInstance = new Chart(pieCtx, {
      type: "doughnut",
      data: {
          labels: Object.keys(cats),
          datasets: [{
              data: Object.values(cats),
              backgroundColor: colors,
              borderWidth: 0,
              hoverOffset: 4
          }]
      },
      options: { 
          responsive: true, 
          maintainAspectRatio: false,
          plugins: { legend: { position: 'left', labels: { boxWidth: 10, font: {size: 10} } } } 
      }
  });

  let cum = 0;
  let vals = [];
  const sortedExp = [...m.expenses].sort((a,b) => new Date(a.date) - new Date(b.date));
  
  sortedExp.forEach(e => {
      if(e.category !== "Saved"){
          cum += e.amount;
          vals.push({x: e.date, y: cum});
      }
  });

  const lineCtx = document.getElementById('lineChart').getContext('2d');
  if(lineChartInstance) lineChartInstance.destroy();
  
  const labels = vals.map((_, i) => i + 1); 
  const dataPoints = vals.map(v => v.y);

  lineChartInstance = new Chart(lineCtx, {
      type: "line",
      data: {
          labels: labels,
          datasets: [
            {
              label: "Spending",
              data: dataPoints,
              borderColor: "#f48fb1", 
              borderWidth: 2,
              tension: 0.4,
              fill: true,
              backgroundColor: "rgba(244, 143, 177, 0.15)", 
              pointBackgroundColor: "#f48fb1",
              pointRadius: 3
            },
            {
                label: "Limit",
                data: labels.map(() => m.income),
                borderColor: "#8fc7a4",
                borderDash: [5, 5],
                pointRadius: 0,
                borderWidth: 1.5
            }
          ]
      },
      options: { 
          responsive: true, 
          maintainAspectRatio: false,
          scales: { 
              y: { beginAtZero: true, grid: { color: '#eee' }, ticks: { font: {size: 10} } },
              x: { grid: { display: false } }
          },
          plugins: { legend: { display: false } }
      }
  });
}

function showTab(id){
  document.querySelectorAll(".tabs button").forEach(b => b.classList.remove("active"));
  const btn = Array.from(document.querySelectorAll(".tabs button")).find(b => b.textContent.toLowerCase() === id);
  if(btn) btn.classList.add("active");
  else if(event) event.target.classList.add("active");

  document.querySelectorAll('.tab-content').forEach(d => d.classList.add('hidden'));
  document.getElementById(id).classList.remove("hidden");
  
  if(id === 'charts') render();
}

function exportCSV() {
    const m = getMonth();
    let csv = "Date,Name,Amount,Type,Category\n";
    m.expenses.forEach(e => {
        csv += `${e.date},${e.name},${e.amount},${e.type},${e.category}\n`;
    });
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `budget_${currentMonth}.csv`;
    a.click();
}

initMonths();
render();

</script>
</body>
</html>
