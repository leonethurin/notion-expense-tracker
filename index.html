<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Notion Expense Tracker</title>
<style>
:root{
  --bg:#fff7f9;--card:#fff;--strawberry:#f28cab;--matcha:#7fbf9b;
  --warning:#ffb703;--danger:#ef476f;--text:#2f2f2f;--muted:#777;
}
*{box-sizing:border-box}
body{font-family:system-ui,-apple-system,sans-serif;background:var(--bg);padding:16px;max-width:1200px;margin:auto;color:var(--text)}
h2{margin-bottom:8px}
.card{background:var(--card);border-radius:16px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
label{font-size:13px;color:var(--muted);display:block;margin-bottom:4px}
input,select{width:100%;padding:8px;border-radius:10px;border:1px solid #ddd;margin-bottom:12px}
button{padding:8px 12px;border:none;border-radius:10px;background:var(--strawberry);color:white;font-weight:600;cursor:pointer}
button.dark{background:#222}
button.small{font-size:12px;padding:4px 8px}
.tabs{display:flex;gap:6px;overflow-x:auto;margin-bottom:12px}
.tab{padding:6px 12px;border-radius:999px;background:#eee;font-size:13px;cursor:pointer}
.tab.active{background:var(--matcha);color:white}
.layout{display:grid;grid-template-columns:2fr 1fr;gap:14px}
.progress{background:#eee;border-radius:999px;overflow:hidden;height:14px;margin:8px 0}
.progress-bar{height:100%;width:0%;transition:.3s}
.safe{background:linear-gradient(90deg,var(--matcha),var(--strawberry))}
.warn{background:var(--warning)}
.danger{background:var(--danger)}
table{width:100%;font-size:13px;border-collapse:collapse}
th,td{border-bottom:1px solid #eee;padding:8px;text-align:left}
.pill{font-size:11px;padding:2px 6px;border-radius:999px;color:white}
.fixed{background:var(--matcha)}
.variable{background:var(--strawberry)}
.saved{background:#6a5acd}
.locked{opacity:.6}
.remaining-box{background:var(--strawberry);color:white;padding:10px;border-radius:12px;margin-top:8px;font-weight:600}
.pie{width:160px;height:160px;border-radius:50%;margin:12px auto}
.legend{font-size:12px}
.legend div{display:flex;align-items:center;gap:6px;margin-bottom:4px}
.legend span{width:10px;height:10px;border-radius:50%}
.hidden{display:none}
</style>
</head>
<body>
<h2>Expense Tracker</h2>
<div class="tabs" id="monthTabs"></div>

<div class="layout">
<div class="card">
  <div class="tabs">
    <div class="tab active" onclick="switchView('tracker')">Tracker</div>
    <div class="tab" onclick="switchView('expenses')">Expenses</div>
  </div>

  <!-- TRACKER -->
  <div id="trackerView">
    <label>Monthly income</label><input id="income" type="number">
    <label>Budget cap</label><input id="budget" type="number">

    <label>Lifetime savings goal</label>
    <input id="savingsGoal" type="number" placeholder="Total target">
    <div class="progress"><div id="savingsBar" class="progress-bar safe"></div></div>
    <small><span id="savingsPct">0%</span> of goal reached</small>

    <div class="progress"><div id="spendBar" class="progress-bar safe"></div></div>

    <button class="dark" onclick="manualSync()">Manual sync month â†’ CSV</button>
  </div>

  <!-- EXPENSES -->
  <div id="expensesView" class="hidden">
    <label>Name</label><input id="expenseName">
    <label>Amount</label><input id="expenseAmount" type="number">
    <label>Type</label>
    <select id="expenseType">
      <option value="fixed">Fixed</option>
      <option value="variable">Variable</option>
      <option value="saved">Saved</option>
    </select>
    <label>Category</label>
    <select id="expenseCategory">
      <option>Rent</option><option>Food</option><option>Fun</option><option>Travel</option><option>Bills</option>
    </select>
    <button onclick="addExpense()">Add</button>

    <table><thead><tr><th>Name</th><th>Type</th><th>Cat</th><th>Amt</th><th></th></tr></thead><tbody id="expenseTable"></tbody></table>
  </div>
</div>

<div class="card">
  <strong>Monthly summary</strong>
  <p>Remaining this month</p>
  <div class="remaining-box"><span id="remaining">0</span></div>
  <p>Fixed: <span id="sumFixed">0</span></p>
  <p>Variable: <span id="sumVariable">0</span></p>
  <p>Saved: <span id="sumSaved">0</span></p>
  <p>Total spent: <span id="sumTotal">0</span></p>

  <hr>
  <strong>Category budgets</strong>
  <div id="categoryBudgets"></div>

  <div id="pieChart" class="pie"></div>
  <div id="pieLegend" class="legend"></div>
</div>
</div>

<script>
const store=JSON.parse(localStorage.getItem('expense-tracker'))||{savingsGoal:0,categoryBudgets:{Rent:0,Food:0,Fun:0,Travel:0,Bills:0}};
let currentMonth=new Date().toISOString().slice(0,7);

function monthData(m){
  if(!store[m]){
    const prev=m.replace(/-(\d+)$/,(_,n)=>`-${String(+n-1).padStart(2,'0')}`);
    const fixed=store[prev]?.expenses?.filter(e=>e.type==='fixed')||[];
    store[m]={income:0,budget:0,expenses:fixed.map(e=>({...e,locked:true}))};
  }
  return store[m];
}

function save(){localStorage.setItem('expense-tracker',JSON.stringify(store))}

function renderTabs(){monthTabs.innerHTML='';Object.keys(store).filter(k=>k.includes('-')).sort().forEach(m=>{const t=document.createElement('div');t.className='tab'+(m===currentMonth?' active':'');t.textContent=m;t.onclick=()=>{currentMonth=m;render()};monthTabs.appendChild(t)})}

function switchView(v){['tracker','expenses'].forEach(x=>document.getElementById(x+'View').classList.toggle('hidden',x!==v));document.querySelectorAll('.card .tab').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.card .tab')[v==='tracker'?0:1].classList.add('active')}

function render(){
  const d=monthData(currentMonth);
  income.value=d.income||'';budget.value=d.budget||'';savingsGoal.value=store.savingsGoal||'';
  expenseTable.innerHTML='';

  let spent=0,fixed=0,variable=0,savedMonth=0,savedTotal=0;
  const catTotals={};
  Object.values(store).forEach(v=>v.expenses?.forEach(e=>{if(e.type==='saved')savedTotal+=e.amount}));

  d.expenses.forEach((e,i)=>{
    if(e.type==='saved'){savedMonth+=e.amount}else{spent+=e.amount}
    if(e.type==='fixed')fixed+=e.amount;if(e.type==='variable')variable+=e.amount;
    catTotals[e.category]=(catTotals[e.category]||0)+e.amount;
    expenseTable.innerHTML+=`<tr class="${e.locked?'locked':''}">
      <td><input ${e.locked?'disabled':''} value="${e.name}" onchange="edit(${i},'name',this.value)"></td>
      <td><span class="pill ${e.type}">${e.type}</span></td>
      <td>${e.category||''}</td>
      <td><input ${e.locked?'disabled':''} type="number" value="${e.amount}" onchange="edit(${i},'amount',this.value)"></td>
      <td>${e.locked?'ðŸ”’':`<button class="small" onclick="del(${i})">âœ•</button>`}</td>
    </tr>`;
  });

  sumFixed.textContent=fixed.toFixed(2);
  sumVariable.textContent=variable.toFixed(2);
  sumSaved.textContent=savedMonth.toFixed(2);
  sumTotal.textContent=spent.toFixed(2);

  const cap=d.budget||d.income;
  const pct=cap?spent/cap:0;
  spendBar.style.width=Math.min(100,pct*100)+'%';
  spendBar.className='progress-bar '+(pct>=1?'danger':pct>=.8?'warn':'safe');

  const sGoal=store.savingsGoal||1;
  const sPct=Math.min(100,(savedTotal/sGoal)*100);
  savingsBar.style.width=sPct+'%';
  savingsPct.textContent=sPct.toFixed(0)+'%';

  remaining.textContent=(d.income-spent).toFixed(2);

  renderCategoryBudgets(catTotals);
  renderPie(catTotals);

  save();renderTabs();
}

function renderCategoryBudgets(catTotals){
  categoryBudgets.innerHTML='';
  Object.keys(store.categoryBudgets).forEach(cat=>{
    const spent=catTotals[cat]||0;
    const cap=store.categoryBudgets[cat]||0;
    categoryBudgets.innerHTML+=`<label>${cat} budget</label><input type="number" value="${cap}" onchange="setCatBudget('${cat}',this.value)"><small>${spent.toFixed(2)} spent</small>`;
  });
}

function renderPie(catTotals){
  const total=Object.values(catTotals).reduce((a,b)=>a+b,0)||1;
  let angle=0;let gradients=[];pieLegend.innerHTML='';
  const colors=['#f28cab','#7fbf9b','#ffb703','#6a5acd','#ef476f'];
  Object.entries(catTotals).forEach(([cat,val],i)=>{
    const a=val/total*360;gradients.push(`${colors[i%colors.length]} ${angle}deg ${angle+a}deg`);
    angle+=a;pieLegend.innerHTML+=`<div><span style="background:${colors[i%colors.length]}"></span>${cat}</div>`;
  });
  pieChart.style.background=`conic-gradient(${gradients.join(',')})`;
}

income.oninput=()=>{monthData(currentMonth).income=+income.value;render()}
budget.oninput=()=>{monthData(currentMonth).budget=+budget.value;render()}
savingsGoal.oninput=()=>{store.savingsGoal=+savingsGoal.value;render()}

function setCatBudget(cat,v){store.categoryBudgets[cat]=+v;render()}

function addExpense(){if(!expenseName.value||!expenseAmount.value)return;monthData(currentMonth).expenses.push({name:expenseName.value,amount:+expenseAmount.value,type:expenseType.value,category:expenseCategory.value});expenseName.value='';expenseAmount.value='';render()}
function edit(i,k,v){monthData(currentMonth).expenses[i][k]=k==='amount'?+v:v;render()}
function del(i){monthData(currentMonth).expenses.splice(i,1);render()}

function manualSync(){const d=monthData(currentMonth);let csv='Month,Income,Budget,Expense,Type,Category,Amount\n';d.expenses.forEach(e=>csv+=`${currentMonth},${d.income},${d.budget},${e.name},${e.type},${e.category||''},${e.amount}\n`);const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));a.download=`expenses-${currentMonth}.csv`;a.click()}

render();
</script>
</body>
</html>
