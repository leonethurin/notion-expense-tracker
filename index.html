<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Notion Expense Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --matcha: #8fc7a4;
  --matcha-dark: #79b895;
  --strawberry: #f48fb1;
  --strawberry-dark: #ec7aa0;
  --card-bg: #ffffff;
  --soft-bg: #f7f7f7;
}

* { box-sizing: border-box; }

body {
  font-family: system-ui, sans-serif;
  background: #fafafa;
  margin: 0;
  padding: 0;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

.app {
  max-width: 1100px;
  margin: 0 auto;
  padding: 0 24px;
  width: 100%;
}

.container {
  display: grid;
  grid-template-columns: 70% 30%;
  gap: 24px;
}

.card {
  background: var(--card-bg);
  border-radius: 20px;
  padding: 20px;
}

.soft-card {
  background: var(--soft-bg);
  border-radius: 16px;
  padding: 14px;
}

.tabs-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.tabs {
  display: flex;
  gap: 10px;
}

.tabs button {
  padding: 8px 14px;
  border-radius: 10px;
  border: none;
  background: #eee;
  cursor: pointer;
}

.tabs button.active {
  background: var(--matcha);
  color: white;
}

button {
  background: var(--matcha);
  color: white;
  border: none;
  border-radius: 10px;
  padding: 8px 14px;
  cursor: pointer;
  transition: background 0.2s ease;
}

button:hover {
  background: var(--matcha-dark);
}

.hidden { display: none; }

input, select {
  width: 100%;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #ddd;
}

#monthSelect {
  width: auto;
  padding: 8px 12px;
}

.grid-2 {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
}

.progress {
  background: #eaeaea;
  height: 14px;
  border-radius: 10px;
  overflow: hidden;
}

.progress > div {
  height: 100%;
}

.expenses-scroll {
  max-height: 360px;
  overflow-y: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
}

td, th {
  padding: 6px;
  font-size: 13px;
}

.kpis {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 14px;
  margin-bottom: 16px;
}

.kpi {
  background: var(--soft-bg);
  border-radius: 14px;
  padding: 14px;
  text-align: center;
}

.kpi:nth-child(1) {
  background: var(--strawberry);
  color: white;
}

.kpi:nth-child(2) {
  background: var(--matcha);
  color: white;
}

.kpi:nth-child(3) {
  background: var(--strawberry);
  color: white;
}

.kpi strong {
  font-size: 1.4em;
  display: block;
  margin-top: 6px;
}

.chart-grid {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 16px;
  align-items: center;
}

.chart-box {
  background: transparent;
  border-radius: 16px;
  padding: 12px;
}

.chart-box:nth-child(1) {
  width: 220px;
  height: 220px;
}

.chart-box:nth-child(2) {
  height: 300px;
  min-width: 450px;
}

canvas {
  width: 100% !important;
  height: 100% !important;
}

.summary-section {
  margin-bottom: 12px;
}

.summary-section p {
  margin: 4px 0;
  font-size: 14px;
  font-weight: 600;
}
</style>
</head>

<body>
<div class="app">

<div class="container">

<!-- MAIN -->
<div class="card">

<div class="tabs-row">
  <div class="tabs">
    <button class="active" onclick="showTab('track')">Track</button>
    <button onclick="showTab('expenses')">Expenses</button>
    <button onclick="showTab('charts')">Charts</button>
  </div>

  <select id="monthSelect" onchange="changeMonth()"></select>
</div>

<!-- TRACK -->
<div id="track">
  <div class="grid-2">
    <div>
      <label>Monthly income</label>
      <input id="income" type="number" onchange="saveMeta()" />
    </div>
    <div>
      <label>Savings goal</label>
      <input id="savingsGoal" type="number" onchange="saveMeta()" />
    </div>
  </div>

  <h3>Add expense</h3>
  <div class="grid-2">
    <input id="name" placeholder="Name" />
    <input id="amount" type="number" placeholder="Amount" />
    <select id="type">
      <option>Fixed</option>
      <option>Variable</option>
    </select>
    <select id="category">
      <option>Rent</option>
      <option>Food</option>
      <option>Fun</option>
      <option>Travel</option>
      <option>Saved</option>
    </select>
  </div>
  <button style="margin-top:10px" onclick="addExpense()">Add</button>
</div>

<!-- EXPENSES -->
<div id="expenses" class="hidden">
  <div class="expenses-scroll">
    <table>
      <thead>
        <tr>
          <th>Date</th><th>Name</th><th>Amount</th><th>Type</th><th>Category</th><th></th>
        </tr>
      </thead>
      <tbody id="expenseTable"></tbody>
    </table>
  </div>
</div>

<!-- CHARTS -->
<div id="charts" class="hidden">
  <div class="kpis">
    <div class="kpi">Income<br><strong id="kIncome">0</strong></div>
    <div class="kpi">Expenses<br><strong id="kExpenses">0</strong></div>
    <div class="kpi">Saved<br><strong id="kSaved">0</strong></div>
  </div>

  <div class="chart-grid">
    <div class="chart-box"><canvas id="pieChart"></canvas></div>
    <div class="chart-box"><canvas id="lineChart"></canvas></div>
  </div>
</div>

</div>

<!-- SUMMARY -->
<div class="card">
<h2>Monthly summary</h2>

<div class="summary-section">
  <p>Income: <span id="sIncome">0</span></p>
  <p>Expenses: <span id="sExpenses">0</span></p>
  <p>Saved: <span id="sSaved">0</span></p>
</div>

<h4 style="margin-bottom: 6px;">Income usage</h4>
<div class="progress"><div id="incomeBar" style="background:var(--matcha)"></div></div>

<h4 style="margin-bottom: 6px; margin-top: 14px;">Savings goal</h4>
<div class="progress"><div id="saveBar" style="background:var(--strawberry)"></div></div>

<div style="background:var(--strawberry);color:white;padding:12px;border-radius:14px;margin-top:14px">
Remaining this month: <strong id="remaining">0</strong>
</div>

<button style="margin-top:10px;width:100%">Manual sync → CSV</button>
</div>

</div>
</div>

<script>
let data = JSON.parse(localStorage.getItem("budgetData")) || {};
let currentMonth = new Date().toISOString().slice(0,7);

function initMonths(){
  const sel = monthSelect;
  sel.innerHTML = "";
  for(let i=0;i<6;i++){
    const d = new Date();
    d.setMonth(d.getMonth()-i);
    const m = d.toISOString().slice(0,7);
    sel.innerHTML += `<option>${m}</option>`;
  }
  sel.value = currentMonth;
}

function getMonth(){
  if(!data[currentMonth]) data[currentMonth]={income:0,goal:0,expenses:[]};
  return data[currentMonth];
}

function save(){ localStorage.setItem("budgetData",JSON.stringify(data)); }

function changeMonth(){ currentMonth = monthSelect.value; render(); }

function saveMeta(){
  const m = getMonth();
  m.income = +income.value;
  m.goal = +savingsGoal.value;
  save(); render();
}

function addExpense(){
  if(!name.value || !amount.value) return;
  getMonth().expenses.push({
    id: Date.now(),
    name: name.value,
    amount: +amount.value,
    type: type.value,
    category: category.value,
    date: new Date().toISOString().slice(0,10)
  });
  name.value = "";
  amount.value = "";
  type.value = "Fixed";
  category.value = "Rent";
  save(); render();
}

let pie,line;

function deleteExpense(i){
  getMonth().expenses.splice(i,1);
  save(); render();
}

function render(){
  const m = getMonth();
  income.value = m.income;
  savingsGoal.value = m.goal;

  let exp = m.expenses.filter(e=>e.category!=="Saved").reduce((a,b)=>a+b.amount,0);
  let saved = m.expenses.filter(e=>e.category==="Saved").reduce((a,b)=>a+b.amount,0);

  sIncome.textContent = kIncome.textContent = m.income;
  sExpenses.textContent = kExpenses.textContent = exp;
  sSaved.textContent = kSaved.textContent = saved;
  remaining.textContent = (m.income-exp-saved).toFixed(2);

  incomeBar.style.width = m.income? (exp/m.income*100)+"%":"0%";
  saveBar.style.width = m.goal? (saved/m.goal*100)+"%":"0%";

  expenseTable.innerHTML = m.expenses.map((e,i)=>`
    <tr>
      <td><input type="date" value="${e.date}" onchange="m.expenses[${i}].date=this.value;save();render()"></td>
      <td><input type="text" value="${e.name}" onchange="m.expenses[${i}].name=this.value;save();render()"></td>
      <td><input type="number" value="${e.amount}" onchange="m.expenses[${i}].amount=+this.value;save();render()"></td>
      <td><select onchange="m.expenses[${i}].type=this.value;save();render()"><option ${e.type=="Fixed"?"selected":""}>Fixed</option><option ${e.type=="Variable"?"selected":""}>Variable</option></select></td>
      <td><select onchange="m.expenses[${i}].category=this.value;save();render()"><option ${e.category=="Rent"?"selected":""}>Rent</option><option ${e.category=="Food"?"selected":""}>Food</option><option ${e.category=="Fun"?"selected":""}>Fun</option><option ${e.category=="Travel"?"selected":""}>Travel</option><option ${e.category=="Saved"?"selected":""}>Saved</option></select></td>
      <td><button onclick="deleteExpense(${i})">✕</button></td>
    </tr>`).join("");

  drawCharts(m);
}

function drawCharts(m){
  const cats={};
  m.expenses.filter(e=>e.category!=="Saved").forEach(e=>cats[e.category]=(cats[e.category]||0)+e.amount);

  pie?.destroy();
  pie=new Chart(pieChart,{type:"pie",data:{labels:Object.keys(cats),datasets:[{data:Object.values(cats),backgroundColor:["#f48fb1","#8fc7a4","#ffd1dc","#c8e6c9"]}]}});
  
  let cum=0,vals=[];
  m.expenses.forEach(e=>{ if(e.category!=="Saved"){cum+=e.amount;vals.push(cum);} });

  line?.destroy();
  line=new Chart(lineChart,{type:"line",data:{labels:vals.map((_,i)=>i+1),datasets:[
    {label:"Expenses",data:vals,borderColor:"#f48fb1",tension:0.3},
    {label:"Budget",data:vals.map(()=>m.income),borderColor:"#8fc7a4",borderDash:[6,6],tension:0.3}
  ]},options:{maintainAspectRatio:true,responsive:true}});
}

function showTab(id){
  document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");
  track.classList.add("hidden");
  expenses.classList.add("hidden");
  charts.classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}

initMonths(); render();
</script>
</body>
</html>
